@startuml

package "User Module" {
    package "Entities" {
        class User {
            +Long id <<PK>>
            -String name
            -String password
            -String email
        }
    }

    package "DTO" {
        class UserDTO {
            +Long id
            -String name
            -String email
        }

        class LoginResponseDTO {
            +String token
            -UserDTO user
        }
    }

    package "Repositories" {
        interface UserRepository {
            +Optional<User> findById(Long id)
            +List<User> findAll()
            +User save(User user)
            +void deleteById(Long id)
            +boolean existsById(Long id)
        }
    }

    package "Services" {
        interface UserService {
            +UserDTO getUser(Long id)
            +List<UserDTO> getAllUsers()
            +UserDTO saveUser(UserDTO userDTO)
            +UserDTO updateUser(Long id, UserDTO userDTO)
            +void deleteUser(Long id)
        }

        class UserServiceImpl {
            +UserDTO getUser(Long id)
            +List<UserDTO> getAllUsers()
            +UserDTO saveUser(UserDTO userDTO)
            +UserDTO updateUser(Long id, UserDTO userDTO)
            +void deleteUser(Long id)
        }
    }

    package "Controllers" {
        class UserController {
            +ResponseEntity<UserDTO> getUser(Long id)
            +ResponseEntity<List<UserDTO>> getAllUsers()
            +ResponseEntity<UserDTO> saveUser(UserDTO userDTO)
            +ResponseEntity<UserDTO> updateUser(Long id, UserDTO userDTO)
            +ResponseEntity<Void> deleteUser(Long id)
        }
    }

    package "Exceptions" {
        class UserNotFoundException {
            +UserNotFoundException(Long id)
        }

        class UserAlreadyExistsException {
            +UserAlreadyExistsException(String username, String email)
        }

        class UserValidationException {
            +UserValidationException(String message)
        }
    }
}

package "Serie Module" {
    package "Entities" {
        class Series {
            +Long id <<PK>>
            -String name
            -String platform
            -String synopsis
            -String cover
        }

        class Rating {
            +Long id <<PK>>
            -Double rating
            -Long seriesId <<FK>>
            -Long userId <<FK>>
        }
    }

    package "DTO" {
        class SeriesDTO {
            +Long id
            -String name
            -String platform
            -String synopsis
            -String cover
        }

        class RatingDTO {
            +Long id
            -Double rating
            -Long seriesId
            -Long userId
        }
    }

    package "Repositories" {
        interface SeriesRepository {
            +Optional<Series> findById(Long id)
            +List<Series> findAll()
            +Series save(Series series)
            +void deleteById(Long id)
            +boolean existsById(Long id)
        }

        interface RatingRepository {
            +Optional<Rating> findById(Long id)
            +List<Rating> findAll()
            +Rating save(Rating rating)
            +boolean existsByUserIdAndSeriesId(Long userId, Long seriesId)
        }
    }

    package "Services" {
        interface SeriesService {
            +SeriesDTO getSeries(Long id)
            +List<SeriesDTO> getAllSeries()
            +SeriesDTO saveSeries(SeriesDTO seriesDTO)
            +SeriesDTO updateSeries(Long id, SeriesDTO seriesDTO)
            +void deleteSeries(Long id)
        }

        class SeriesServiceImpl {
            +SeriesDTO getSeries(Long id)
            +List<SeriesDTO> getAllSeries()
            +SeriesDTO saveSeries(SeriesDTO seriesDTO)
            +SeriesDTO updateSeries(Long id, SeriesDTO seriesDTO)
            +void deleteSeries(Long id)
        }

        interface RatingService {
            +RatingDTO getRating(Long id)
            +List<RatingDTO> getAllRatings()
            +RatingDTO saveRating(RatingDTO ratingDTO)
            +RatingDTO updateRating(Long id, RatingDTO ratingDTO)
            +void deleteRating(Long id)
        }

        class RatingServiceImpl {
            +RatingDTO getRating(Long id)
            +List<RatingDTO> getAllRatings()
            +RatingDTO saveRating(RatingDTO ratingDTO)
            +RatingDTO updateRating(Long id, RatingDTO ratingDTO)
            +void deleteRating(Long id)
        }
    }

    package "Controllers" {
        class SeriesController {
            +ResponseEntity<SeriesDTO> getSeries(Long id)
            +ResponseEntity<List<SeriesDTO>> getAllSeries()
            +ResponseEntity<SeriesDTO> saveSeries(SeriesDTO seriesDTO)
            +ResponseEntity<SeriesDTO> updateSeries(Long id, SeriesDTO seriesDTO)
            +ResponseEntity<Void> deleteSeries(Long id)
        }

        class RatingController {
            +ResponseEntity<RatingDTO> getRating(Long id)
            +ResponseEntity<List<RatingDTO>> getAllRatings()
            +ResponseEntity<RatingDTO> saveRating(RatingDTO ratingDTO)
            +ResponseEntity<RatingDTO> updateRating(Long id, RatingDTO ratingDTO)
            +ResponseEntity<Void> deleteRating(Long id)
        }
    }

    package "Exceptions" {
        class SeriesNotFoundException {
            +SeriesNotFoundException(Long id)
        }

        class RatingNotFoundException {
            +RatingNotFoundException(Long id)
        }

        class SeriesValidationException {
            +SeriesValidationException(String message)
        }

        class RatingValidationException {
            +RatingValidationException(String message)
        }
    }
}

package "Security" {
    class JWTUtil {
        +String generateToken(User user)
        +Boolean validateToken(String token, User user)
    }

    class JWTFilter {
        +doFilter(...)
    }
}

' Relationships
User "1" -- "0..*" Rating : "makes"
Series "1" -- "0..*" Rating : "has"
UserRepository ..> User
SeriesRepository ..> Series
RatingRepository ..> Rating
UserService ..> UserRepository
UserServiceImpl ..|> UserService
SeriesService ..> SeriesRepository
SeriesServiceImpl ..|> SeriesService
RatingService ..> RatingRepository
RatingServiceImpl ..|> RatingService
UserController ..> UserService
SeriesController ..> SeriesService
RatingController ..> RatingService
JWTUtil ..> User
JWTFilter ..> JWTUtil

@enduml
